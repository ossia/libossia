cmake_minimum_required(VERSION 3.0)
project(APITests)

include_directories("${API_IMPL_FOLDER}/Jamoma/Sources")

find_package(Qt5 5.3 REQUIRED COMPONENTS Core Test)
find_package(Jamoma 0.6)

set(CMAKE_AUTOMOC ON)
set(CMAKE_INCLUDE_CURRENT_DIR ON)

if (OSSIA_COVERALLS)
    get_property(JAMOMA_API_SRCS TARGET APIJamoma PROPERTY SOURCES)
    coveralls_setup("${JAMOMA_API_SRCS}" ON)
endif()
function(addAPIQtTest TESTNAME TESTSRCS)
    if(${Jamoma_FOUND})
        add_executable(Jamoma_${TESTNAME} ${TESTSRCS})
        target_link_libraries(Jamoma_${TESTNAME} Qt5::Core Qt5::Test Jamoma::Modular Jamoma::Foundation APIJamoma Jamoma::Score)
        add_test(NAME Jamoma_target_${TESTNAME} COMMAND Jamoma_${TESTNAME})
    endif()
endFunction()

addAPIQtTest(APIAutomationTest              "${CMAKE_CURRENT_SOURCE_DIR}/Editor/AutomationTest.cpp")
addAPIQtTest(APIClockTest                   "${CMAKE_CURRENT_SOURCE_DIR}/Editor/ClockTest.cpp")
addAPIQtTest(APICurveTest                   "${CMAKE_CURRENT_SOURCE_DIR}/Editor/CurveTest.cpp")
addAPIQtTest(APICurveSegmentEmptyTest       "${CMAKE_CURRENT_SOURCE_DIR}/Editor/CurveSegment/CurveSegmentEmptyTest.cpp")
addAPIQtTest(APICurveSegmentLinearTest      "${CMAKE_CURRENT_SOURCE_DIR}/Editor/CurveSegment/CurveSegmentLinearTest.cpp")
addAPIQtTest(APICurveSegmentPowerTest       "${CMAKE_CURRENT_SOURCE_DIR}/Editor/CurveSegment/CurveSegmentPowerTest.cpp")
addAPIQtTest(APIDomainTest                  "${CMAKE_CURRENT_SOURCE_DIR}/Editor/DomainTest.cpp")
addAPIQtTest(APIExpressionTest              "${CMAKE_CURRENT_SOURCE_DIR}/Editor/ExpressionTest.cpp")
addAPIQtTest(APIExpressionAtomTest          "${CMAKE_CURRENT_SOURCE_DIR}/Editor/ExpressionAtomTest.cpp")
addAPIQtTest(APIExpressionCompositionTest   "${CMAKE_CURRENT_SOURCE_DIR}/Editor/ExpressionCompositionTest.cpp")
addAPIQtTest(APIExpressionNotTest           "${CMAKE_CURRENT_SOURCE_DIR}/Editor/ExpressionNotTest.cpp")
addAPIQtTest(APIExpressionPulseTest         "${CMAKE_CURRENT_SOURCE_DIR}/Editor/ExpressionPulseTest.cpp")
addAPIQtTest(APILoopTest                    "${CMAKE_CURRENT_SOURCE_DIR}/Editor/LoopTest.cpp")
addAPIQtTest(APIMessageTest                 "${CMAKE_CURRENT_SOURCE_DIR}/Editor/MessageTest.cpp")
addAPIQtTest(APIScenarioTest                "${CMAKE_CURRENT_SOURCE_DIR}/Editor/ScenarioTest.cpp")
addAPIQtTest(APIStateTest                   "${CMAKE_CURRENT_SOURCE_DIR}/Editor/StateTest.cpp")
addAPIQtTest(APITimeConstraintTest          "${CMAKE_CURRENT_SOURCE_DIR}/Editor/TimeConstraintTest.cpp")
addAPIQtTest(APITimeEventTest               "${CMAKE_CURRENT_SOURCE_DIR}/Editor/TimeEventTest.cpp")
addAPIQtTest(APITimeNodeTest                "${CMAKE_CURRENT_SOURCE_DIR}/Editor/TimeNodeTest.cpp")
addAPIQtTest(APITimeValueTest               "${CMAKE_CURRENT_SOURCE_DIR}/Editor/TimeValueTest.cpp")
addAPIQtTest(APIValueTest                   "${CMAKE_CURRENT_SOURCE_DIR}/Editor/ValueTest.cpp")

addAPIQtTest(APIAddressTest                 "${CMAKE_CURRENT_SOURCE_DIR}/Network/AddressTest.cpp")
addAPIQtTest(APIDeviceTest                  "${CMAKE_CURRENT_SOURCE_DIR}/Network/DeviceTest.cpp")
addAPIQtTest(APINodeTest                    "${CMAKE_CURRENT_SOURCE_DIR}/Network/NodeTest.cpp")

if(OSSIA_BENCHMARKS)
addAPIQtTest(APIDeviceBenchmark_Nsec_client "${CMAKE_CURRENT_SOURCE_DIR}/Benchmarks/DeviceBenchmark_Nsec_client.cpp")
addAPIQtTest(APIDeviceBenchmark_Nsec_server "${CMAKE_CURRENT_SOURCE_DIR}/Benchmarks/DeviceBenchmark_Nsec_server.cpp")
addAPIQtTest(APIDeviceBenchmark_client      "${CMAKE_CURRENT_SOURCE_DIR}/Benchmarks/DeviceBenchmark_client.cpp")
addAPIQtTest(APIDeviceBenchmark             "${CMAKE_CURRENT_SOURCE_DIR}/Benchmarks/DeviceBenchmark.cpp"
                                            "${CMAKE_CURRENT_SOURCE_DIR}/Benchmarks/Random.hpp")
# addAPIQtTest(APIAutomationBenchmark         "${CMAKE_CURRENT_SOURCE_DIR}/Benchmarks/AutomationBenchmark.cpp
endif()
include(CTest)
